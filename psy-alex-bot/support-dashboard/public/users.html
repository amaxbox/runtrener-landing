<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пользователи - Support Dashboard</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        'apple-blue': '#007AFF',
                        'apple-gray': {
                            50: '#F5F5F7',
                            100: '#F2F2F7',
                            200: '#E5E5EA',
                            300: '#D1D1D6',
                            400: '#C7C7CC',
                            500: '#AEAEB2',
                            600: '#8E8E93',
                            700: '#636366',
                            800: '#48484A',
                            900: '#1C1C1E',
                        }
                    },
                    boxShadow: {
                        'apple': '0 4px 16px rgba(0, 0, 0, 0.08)',
                        'apple-sm': '0 2px 8px rgba(0, 0, 0, 0.04)',
                    },
                    borderRadius: {
                        'apple': '12px',
                        'apple-lg': '20px',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-apple-gray-50 antialiased">
    <!-- Fixed Header -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-2xl border-b border-apple-gray-200 shadow-apple-sm">
        <div class="max-w-7xl mx-auto px-8 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <a href="/dashboard.html" class="text-2xl font-semibold text-apple-gray-900 tracking-tight hover:opacity-80">Support</a>

                    <!-- Main Navigation -->
                    <div class="flex gap-4">
                        <a
                            href="/users.html"
                            class="px-4 py-2 text-sm font-medium text-apple-blue border-b-2 border-apple-blue transition"
                        >
                            Пользователи
                        </a>
                        <a
                            href="/payments.html"
                            class="px-4 py-2 text-sm font-medium text-apple-gray-600 border-b-2 border-transparent hover:text-apple-gray-900 transition"
                        >
                            Реестр оплат
                        </a>
                    </div>
                </div>

                <button
                    onclick="logout()"
                    class="px-5 py-2.5 text-sm font-medium text-apple-blue hover:opacity-80 transition rounded-apple"
                >
                    Выйти
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content with Side Panel Layout -->
    <div class="pt-20 flex">
        <!-- Left: Main Users List (Desktop: fixed width, Mobile: full width when no panel) -->
        <div class="flex-1 md:flex-0 md:w-[450px] border-r border-apple-gray-200" id="usersListSection">
            <div class="px-8 py-10 max-w-full">
                <!-- Header -->
                <div class="mb-10">
                    <h2 class="text-3xl font-semibold text-apple-gray-900 tracking-tight">Пользователи</h2>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-apple-lg p-6 mb-6 shadow-apple">
                    <!-- Search -->
                    <div class="mb-4">
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Поиск по ID, имени, фамилии или username..."
                            class="w-full px-4 py-2.5 bg-apple-gray-50 border border-apple-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-sm"
                        >
                    </div>

                    <!-- Date Range, Subscription, Status -->
                    <div class="grid grid-cols-1 gap-3 mb-4">
                        <input
                            type="date"
                            id="dateFrom"
                            placeholder="От"
                            class="w-full px-3 py-1.5 bg-apple-gray-50 border border-apple-gray-200 rounded-lg text-sm"
                        >
                        <input
                            type="date"
                            id="dateTo"
                            placeholder="До"
                            class="w-full px-3 py-1.5 bg-apple-gray-50 border border-apple-gray-200 rounded-lg text-sm"
                        >

                        <!-- Subscription -->
                        <div class="flex gap-1.5">
                            <button id="subTabAll" onclick="setSubscriptionFilter('')" class="flex-1 px-2 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-medium">Все</button>
                            <button id="subTabFree" onclick="setSubscriptionFilter('free')" class="flex-1 px-2 py-1.5 bg-apple-gray-100 text-apple-gray-700 rounded-lg text-xs font-medium hover:bg-apple-gray-200">Free</button>
                            <button id="subTabPro" onclick="setSubscriptionFilter('pro')" class="flex-1 px-2 py-1.5 bg-apple-gray-100 text-apple-gray-700 rounded-lg text-xs font-medium hover:bg-apple-gray-200">Pro</button>
                        </div>

                        <!-- Status -->
                        <select id="statusFilter" class="w-full px-3 py-1.5 bg-apple-gray-50 border border-apple-gray-200 rounded-lg text-sm">
                            <option value="">Все статусы</option>
                            <option value="active">Active</option>
                            <option value="stop">Stop</option>
                            <option value="ban">Ban</option>
                            <option value="mute">Mute</option>
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="flex gap-3">
                        <button id="applyFilters" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm">Применить</button>
                        <button id="resetFilters" class="px-5 py-2 bg-apple-gray-100 text-apple-gray-700 rounded-lg hover:bg-apple-gray-200 font-medium text-sm">Сбросить</button>
                    </div>
                </div>

                <!-- Users Count -->
                <p id="usersCount" class="text-sm text-apple-gray-600 mb-4">Найдено: 0 пользователей</p>

                <!-- Users Table -->
                <div class="bg-white border border-apple-gray-200 rounded-apple-lg overflow-hidden mb-6 shadow-apple" id="usersTableContainer">
                    <div class="p-10 text-center text-apple-gray-600">Загрузка...</div>
                </div>

                <!-- Pagination -->
                <div class="flex justify-center gap-2" id="pagination"></div>
            </div>
        </div>

        <!-- Right: User Detail Side Panel (Desktop: 640px max, but not more than 50% screen, Mobile: fullscreen) -->
        <div class="hidden md:block md:w-[640px] md:overflow-y-auto md:max-h-[calc(100vh-80px)] md:border-l md:border-apple-gray-200 md:max-w-[50vw]" id="userDetailPanel">
            <!-- User Detail Content -->
            <div class="px-6 py-10">
                <!-- Close Button & User Header -->
                <div class="flex items-center justify-between mb-8 sticky top-0 bg-white/95 -mx-6 px-6 pt-3 pb-3 border-b border-apple-gray-200">
                    <div class="flex items-center gap-2">
                        <button
                            onclick="shareUserLink()"
                            class="p-2 text-apple-blue hover:opacity-80 transition rounded-apple"
                            id="shareUserLinkBtn"
                            title="Скопировать ссылку"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.658 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                            </svg>
                        </button>
                    </div>
                    <button
                        onclick="closeUserDetail()"
                        class="p-2 text-apple-gray-600 hover:text-apple-gray-900 hover:opacity-80 transition rounded-apple"
                        title="Закрыть"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- User Info Header -->
                <div class="mb-8">
                    <h3 class="text-2xl font-semibold text-apple-gray-900 tracking-tight" id="userNameHeader">Загрузка...</h3>
                    <p class="text-sm text-apple-gray-600 mt-2" id="userIdHeader">—</p>
                </div>

                <!-- Tabs Navigation -->
                <div class="border-b border-apple-gray-200 mb-8 -mx-8 px-8">
                    <div class="flex gap-6 overflow-x-auto">
                        <button class="tab-button py-4 text-sm font-medium text-apple-blue border-b-2 border-apple-blue whitespace-nowrap transition" data-tab="chat">Диалог</button>
                        <button class="tab-button py-4 text-sm font-medium text-apple-gray-600 border-b-2 border-transparent whitespace-nowrap hover:text-apple-gray-900 transition" data-tab="therapy">Профиль</button>
                        <button class="tab-button py-4 text-sm font-medium text-apple-gray-600 border-b-2 border-transparent whitespace-nowrap hover:text-apple-gray-900 transition" data-tab="payments">Платежи</button>
                        <button class="tab-button py-4 text-sm font-medium text-apple-gray-600 border-b-2 border-transparent whitespace-nowrap hover:text-apple-gray-900 transition" data-tab="info">Остальное</button>
                    </div>
                </div>

                <!-- Tab: Chat -->
                <div class="tab-content active" id="tab-chat">
                    <!-- Chat Controls -->
                    <div class="flex justify-between items-center mb-6 flex-wrap gap-3">
                        <div class="flex gap-3">
                            <button
                                id="sortNewestFirst"
                                class="px-5 py-2.5 bg-apple-blue text-white rounded-apple text-sm font-medium hover:opacity-90 active:opacity-80 transition"
                            >
                                Новые сверху
                            </button>
                            <button
                                id="sortOldestFirst"
                                class="px-5 py-2.5 bg-apple-gray-100 text-apple-gray-700 rounded-apple text-sm font-medium hover:bg-apple-gray-200 transition"
                            >
                                Старые сверху
                            </button>
                        </div>
                        <div id="chatMessagesCount" class="text-sm text-apple-gray-600">
                            Загрузка...
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div id="chatLogs" class="text-apple-gray-600 text-base">Загрузка...</div>

                    <!-- Chat Pagination -->
                    <div id="chatPagination" class="flex justify-center gap-2 mt-8">
                        <!-- Pagination buttons -->
                    </div>
                </div>

                <!-- Tab: Therapy Profile -->
                <div class="tab-content" id="tab-therapy">
                    <div id="therapyProfile" class="text-apple-gray-600 text-base">Загрузка...</div>
                </div>

                <!-- Tab: Payments -->
                <div class="tab-content" id="tab-payments">
                    <div id="payments" class="text-apple-gray-600 text-base">Загрузка...</div>
                </div>

                <!-- Tab: Остальное (User Info) -->
                <div class="tab-content" id="tab-info">
                    <div id="userInfo" class="text-apple-gray-600 text-base">Загрузка...</div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .tab-content {
            max-height: calc(100vh - 400px);
            overflow-y: auto;
        }

        .tab-content::-webkit-scrollbar {
            width: 6px;
        }

        .tab-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .tab-content::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .tab-content::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>

    <script src="auth.js"></script>
    <script src="users.js"></script>
    <script>
        function logout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                auth.logout();
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>
