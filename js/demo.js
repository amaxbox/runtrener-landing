// –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥-–¥–µ–º–æ
const demoMessages = [
    {
        sender: 'user',
        text: '–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É –Ω–∞—á–∞—Ç—å –±–µ–≥–∞—Ç—å –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∑–∞–±–µ–≥—É –Ω–∞ 5 –∫–º. –Ø –Ω–æ–≤–∏—á–æ–∫ –≤ –±–µ–≥–µ.',
        delay: 1500
    },
    {
        sender: 'bot',
        text: '–ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ —Ä–µ—à–∏–ª –∑–∞–Ω—è—Ç—å—Å—è –±–µ–≥–æ–º ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å–Ω—ã–π –≤—ã–±–æ—Ä! –ü–æ–º–æ–≥—É —Ç–µ–±–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–±–µ–≥—É –Ω–∞ 5–∫–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.',
        delay: 2500
    },
    {
        sender: 'bot',
        text: '–î–∞–≤–∞–π –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è –ø–æ–±–ª–∏–∂–µ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞:\n1. –°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç, –∫–∞–∫–æ–π —Ä–æ—Å—Ç –∏ –≤–µ—Å?\n2. –ï—Å—Ç—å –ª–∏ –∫–∞–∫–æ–π-—Ç–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –æ–ø—ã—Ç –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ–π—á–∞—Å?\n3. –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∑–∞–±–µ–≥–µ –Ω–∞ 5–∫–º?',
        delay: 2000
    },
    {
        sender: 'user', 
        text: '–ú–Ω–µ 28 –ª–µ—Ç, —Ä–æ—Å—Ç 175 —Å–º, –≤–µ—Å 78 –∫–≥. –°–ø–æ—Ä—Ç–æ–º –æ—Å–æ–±–æ –Ω–µ –∑–∞–Ω–∏–º–∞–ª—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≥–æ–¥—ã, —Ç–æ–ª—å–∫–æ –∏–Ω–æ–≥–¥–∞ –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ.',
        delay: 1800
    },
    {
        sender: 'user',
        text: '–ó–∞–±–µ–≥ —Ö–æ—á—É –ø—Ä–æ–±–µ–∂–∞—Ç—å —á–µ—Ä–µ–∑ 2-3 –º–µ—Å—è—Ü–∞.',
        delay: 1200
    },
    {
        sender: 'bot',
        text: '–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ ‚Äî 8-12 –Ω–µ–¥–µ–ª—å —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π —Å—Ä–æ–∫ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞. –¢–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–æ—Ä–º–µ, —ç—Ç–æ –ø–ª—é—Å.',
        delay: 2200
    },
    {
        sender: 'bot',
        text: '–ï—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:\n1. –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é –≥–æ—Ç–æ–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è?\n2. –í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —É–¥–æ–±–Ω–µ–µ –±–µ–≥–∞—Ç—å ‚Äî —É—Ç—Ä–æ–º –∏–ª–∏ –≤–µ—á–µ—Ä–æ–º?\n3. –ï—Å—Ç—å –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ –∑–¥–æ—Ä–æ–≤—å–µ–º, —Ç—Ä–∞–≤–º—ã?\n4. –ö–∞–∫—É—é —Ü–µ–ª—å —Å—Ç–∞–≤–∏—à—å ‚Äî –ø—Ä–æ—Å—Ç–æ —Ñ–∏–Ω–∏—à–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –µ—Å—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è?',
        delay: 2000
    },
    {
        sender: 'user',
        text: '–ú–æ–≥—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –ª—É—á—à–µ –≤–µ—á–µ—Ä–æ–º –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã. –ó–¥–æ—Ä–æ–≤—å–µ –≤ –ø–æ—Ä—è–¥–∫–µ, —Ç—Ä–∞–≤–º –Ω–µ—Ç.',
        delay: 1600
    },
    {
        sender: 'user',
        text: '–•–æ—á—É –ø—Ä–æ–±–µ–∂–∞—Ç—å 5–∫–º –∑–∞ 30 –º–∏–Ω—É—Ç –∏–ª–∏ –º–µ–Ω—å—à–µ ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞?',
        delay: 1400
    },
    {
        sender: 'bot', 
        text: '–¶–µ–ª—å –ø—Ä–æ–±–µ–∂–∞—Ç—å 5–∫–º –∑–∞ 30 –º–∏–Ω—É—Ç (—Ç–µ–º–ø 6:00/–∫–º) ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ä–µ–∞–ª—å–Ω–∞ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞ –∑–∞ 2-3 –º–µ—Å—è—Ü–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏! –≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∞—è —Ü–µ–ª—å.',
        delay: 2800
    },
    {
        sender: 'bot',
        text: '**–ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –Ω–µ–¥–µ–ª—é:**\n\nüèÉ‚Äç‚ôÇÔ∏è **–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫** ‚Äî –õ–µ–≥–∫–∏–π –±–µ–≥ 20-25 –º–∏–Ω (–ø—É–ª—å—Å 120-140)\nüèÉ‚Äç‚ôÇÔ∏è **–°—Ä–µ–¥–∞** ‚Äî –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: —Ä–∞–∑–º–∏–Ω–∫–∞ 10 –º–∏–Ω + 4—Ö2 –º–∏–Ω –±—ã—Å—Ç—Ä–æ/2 –º–∏–Ω –æ—Ç–¥—ã—Ö + –∑–∞–º–∏–Ω–∫–∞ 10 –º–∏–Ω\nüèÉ‚Äç‚ôÇÔ∏è **–ü—è—Ç–Ω–∏—Ü–∞** ‚Äî –î–ª–∏—Ç–µ–ª—å–Ω—ã–π –±–µ–≥ 30-40 –º–∏–Ω –≤ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–º —Ç–µ–º–ø–µ',
        delay: 3000
    },
    {
        sender: 'bot',
        text: '**–ü–µ—Ä–≤—ã–µ 2 –Ω–µ–¥–µ–ª–∏:** –º–æ–∂–µ—à—å —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –±–µ–≥ –∏ –±—ã—Å—Ç—Ä—É—é —Ö–æ–¥—å–±—É\n**3-4 –Ω–µ–¥–µ–ª–∏:** —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –±–µ–≥\n**5-8 –Ω–µ–¥–µ–ª–∏:** —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —Ç–µ–º–ø–æ–º –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å—é',
        delay: 2500
    },
    {
        sender: 'bot',
        text: '–ù–∞—á–Ω–µ–º —É–∂–µ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ? –ì–æ—Ç–æ–≤ –∫ –ø–µ—Ä–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ?',
        delay: 1800
    }
];

let currentMessageIndex = 0;
let isPlaying = false;

function createMessage(sender, text, animate = true) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    const avatarDiv = document.createElement('div');
    avatarDiv.className = 'message-avatar';
    
    if (sender === 'bot') {
        const avatarImg = document.createElement('img');
        avatarImg.src = '/generated-image.jpg';
        avatarImg.alt = '–¢—Ä–µ–Ω–µ—Ä';
        avatarImg.style.width = '100%';
        avatarImg.style.height = '100%';
        avatarImg.style.borderRadius = '50%';
        avatarImg.style.objectFit = 'cover';
        avatarDiv.appendChild(avatarImg);
    } else {
        avatarDiv.textContent = 'üë§';
    }
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç (–∑–∞–º–µ–Ω—è–µ–º \n –Ω–∞ <br> –∏ –≤—ã–¥–µ–ª—è–µ–º –∂–∏—Ä–Ω—ã–º **—Ç–µ–∫—Å—Ç**)
    const formattedText = text
        .replace(/\n/g, '<br>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    
    contentDiv.innerHTML = formattedText;
    
    const timeDiv = document.createElement('div');
    timeDiv.className = 'message-time';
    timeDiv.textContent = new Date().toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
    
    contentDiv.appendChild(timeDiv);
    messageDiv.appendChild(avatarDiv);
    messageDiv.appendChild(contentDiv);
    
    if (animate) {
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(30px) scale(0.95)';
    }
    
    return messageDiv;
}

function createTypingIndicator() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message bot typing';
    
    const avatarDiv = document.createElement('div');
    avatarDiv.className = 'message-avatar';
    const avatarImg = document.createElement('img');
    avatarImg.src = '/generated-image.jpg';
    avatarImg.alt = '–¢—Ä–µ–Ω–µ—Ä';
    avatarImg.style.width = '100%';
    avatarImg.style.height = '100%';
    avatarImg.style.borderRadius = '50%';
    avatarImg.style.objectFit = 'cover';
    avatarDiv.appendChild(avatarImg);
    
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'typing-indicator';
    typingIndicator.innerHTML = `
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    `;
    
    typingDiv.appendChild(avatarDiv);
    typingDiv.appendChild(typingIndicator);
    return typingDiv;
}

function showMessage(messageElement, delay = 0) {
    return new Promise(resolve => {
        setTimeout(() => {
            messageElement.style.opacity = '1';
            messageElement.style.transform = 'translateY(0) scale(1)';
            messageElement.style.transition = 'all 0.8s cubic-bezier(0.23, 1, 0.32, 1)';
            
            // –£–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–æ–ø–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π
            const chatMessages = document.getElementById('chat-messages');
            const messages = Array.from(chatMessages.children);
            
            // –°–¥–≤–∏–≥–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å—Ç–æ–ø–∫—É
            messages.forEach((msg, index) => {
                if (index < messages.length - 3) {
                    // –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É—Ö–æ–¥—è—Ç –≤ —Å—Ç–æ–ø–∫—É –Ω–∞ –∑–∞–¥–Ω–∏–π –ø–ª–∞–Ω
                    msg.style.transform = `translateY(-${(messages.length - index - 3) * 8}px) scale(${1 - (messages.length - index - 3) * 0.05})`;
                    msg.style.opacity = `${Math.max(0.3, 1 - (messages.length - index - 3) * 0.2)}`;
                    msg.style.zIndex = index;
                } else {
                    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
                    msg.style.transform = 'translateY(0) scale(1)';
                    msg.style.opacity = '1';
                    msg.style.zIndex = 10 + index;
                }
            });
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–≤—Å–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–±–æ–ª—å—à–µ 8)
            if (messages.length > 8) {
                const oldestMessage = messages[0];
                oldestMessage.style.animation = 'messageDisappear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                oldestMessage.style.animationFillMode = 'forwards';
                setTimeout(() => {
                    if (oldestMessage.parentNode) {
                        oldestMessage.parentNode.removeChild(oldestMessage);
                    }
                }, 600);
            }
            
            resolve();
        }, delay);
    });
}

async function playNextMessage() {
    if (currentMessageIndex >= demoMessages.length) {
        // –î–µ–º–æ –∑–∞–∫–æ–Ω—á–µ–Ω–æ, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        isPlaying = false;
        setTimeout(() => {
            startDemo();
        }, 5000);
        return;
    }

    const chatMessages = document.getElementById('chat-messages');
    const message = demoMessages[currentMessageIndex];
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
    let typingIndicator = null;
    if (message.sender === 'bot') {
        typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–µ—á–∞—Ç–∏
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
        chatMessages.removeChild(typingIndicator);
    }
    
    // –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    const messageElement = createMessage(message.sender, message.text);
    chatMessages.appendChild(messageElement);
    
    await showMessage(messageElement, 100);
    
    currentMessageIndex++;
    
    // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    setTimeout(() => {
        if (isPlaying) {
            playNextMessage();
        }
    }, message.delay);
}

function startDemo() {
    const chatMessages = document.getElementById('chat-messages');
    
    // –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    isPlaying = true;
    currentMessageIndex = 0;
    
    // –û—á–∏—â–∞–µ–º —á–∞—Ç
    chatMessages.innerHTML = '';
    
    // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
    setTimeout(() => {
        playNextMessage();
    }, 1000);
}

function restartDemo() {
    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    setTimeout(() => {
        if (!isPlaying) {
            startDemo();
        }
    }, 5000);
}