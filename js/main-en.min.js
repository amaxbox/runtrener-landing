async function fetchGrafanaData(){try{console.log("Fetching data from Grafana...");const fullUrl="/stats-proxy.php";console.log(`Request through local proxy: ${fullUrl}`);const response=await fetch(fullUrl);if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}const data=await response.json();console.log("Real data received from Grafana:",data);return{athletes:data.athletes||1056}}catch(error){console.error("Error getting data through local proxy:",error);console.log("Using last known data");return{athletes:1056}}}async function updateStats(){const statsInfo=document.querySelector(".stats-info");if(statsInfo){statsInfo.style.opacity="0.7";statsInfo.textContent=`üèÉ‚Äç‚ôÇÔ∏è Updating data...`}const grafanaData=await fetchGrafanaData();if(statsInfo){statsInfo.style.opacity="1";statsInfo.textContent=`${grafanaData.athletes} üèÉ‚Äç‚ôÇÔ∏è already with us`}console.log(`Statistics updated: ${grafanaData.athletes} athletes at ${(new Date).toLocaleTimeString()}`)}const allTestimonials=[{quote:"The bot-coach helped me prepare for my first half marathon. Individual training plan and constant support - exactly what a beginner needs. The 1:55 result exceeded all expectations!",author:"Anna Peterson"},{quote:"The goal was ambitious - to improve results on all distances simultaneously. The bot created an ideal plan: already achieved 10K in 55 minutes, now going for the coveted 25 minutes on 5K. Thanks for the systematic approach!",author:"David Clark"},{quote:"I send the bot screenshots of workouts from the app - it instantly analyzes the data and gives specific recommendations. Progressive workouts have become much more effective!",author:"Maria Smith"},{quote:"It's convenient to send voice messages about workouts - the bot understands everything and gives detailed answers. The feedback is always constructive and motivating!",author:"Alex Johnson"},{quote:"Ran the marathon in 4:18 thanks to training with the bot. Now the goal is to conquer the 4-hour mark. I believe it's achievable with such a coach!",author:"Elena Brown"},{quote:"I photograph my breakfasts and lunches - the bot counts calories and gives nutrition advice for runners. It helps maintain optimal weight and energy for workouts!",author:"Steve Wilson"},{quote:"Dreaming of becoming a master of sport in running! Current results: 10K in 54 minutes. The bot helps steadily move toward the goal, considering my physical data and capabilities. At 33, everything is just beginning!",author:"Olga Taylor"},{quote:"The variety of workouts is impressive: steady runs, fartlek, intervals, repeats. The bot explains the purpose of each workout and helps execute them correctly. Progress is obvious!",author:"Igor Davis"},{quote:"Preparing for a marathon with a goal of 3:40-3:50. The bot even considers weather conditions when analyzing workouts! A 100-minute run in the heat went under its control.",author:"Tanya Miller"},{quote:"Started the path to marathon with significant excess weight. The bot created a gentle plan that gradually prepares for big loads. Already feeling progress and confidence!",author:"Andrew White"},{quote:"Everything went well. Completed all plans. The long run went excellently, easily, without fatigue. As planned at 5 min per km, one hour twenty. Average heart rate 147.",author:"Roman"},{quote:"You're an awesome bot, thank you! It's very pleasant to communicate with you.",author:"Christina"},{quote:"The week went well. Ran what was expected according to tasks. On Saturday did strength training, and on Sunday closed with a long 20K, aerobic, average pace 4:54.",author:"Roman"},{quote:"Excellent plan, thank you! Everything is clear and structured.",author:"Dmitry"},{quote:"Yesterday I ran 14K with 330 meters of elevation gain at 6:50 pace. Feeling great!",author:"Maria"},{quote:"You help me so much. I feel great, everything is according to plan, I can easily control the loads.",author:"Roman"}];function getRandomTestimonials(count=6){const shuffled=[...allTestimonials].sort(()=>.5-Math.random());return shuffled.slice(0,count)}function updateTestimonials(){const testimonialsGrid=document.querySelector(".testimonials-grid");if(!testimonialsGrid)return;const randomTestimonials=getRandomTestimonials(6);testimonialsGrid.style.opacity="0.3";setTimeout(()=>{testimonialsGrid.innerHTML=randomTestimonials.map(testimonial=>`
            <div class="testimonial-card">
                <div class="testimonial-quote">${testimonial.quote}</div>
                <div class="testimonial-author">‚Äî ${testimonial.author}</div>
            </div>
        `).join("");testimonialsGrid.style.opacity="1"},200)}const demoMessages=[{sender:"user",text:"Hi! I want to start running and prepare for a 5K race. I'm a beginner in running.",delay:1500},{sender:"bot",text:"Hi! Great that you decided to start running ‚Äî it's an awesome choice! I'll help you prepare for your first 5K race as efficiently and safely as possible.",delay:2500},{sender:"bot",text:"Let's get to know each other better to create an individual plan:\n1. How old are you, what's your height and weight?\n2. Do you have any sports experience or physical activity now?\n3. When are you planning to participate in the 5K race?",delay:2e3},{sender:"user",text:"I'm 28 years old, 5'9\" tall, weigh 172 lbs. Haven't been very active in sports lately, just occasionally at the gym.",delay:1800},{sender:"user",text:"I want to run the race in 2-3 months.",delay:1200},{sender:"bot",text:"Excellent! We have enough time for quality preparation ‚Äî 8-12 weeks is a good timeframe for a beginner. Your parameters are normal, that's a plus.",delay:2200},{sender:"bot",text:"A few more important questions:\n1. How many days a week are you ready to train?\n2. What time is more convenient for running ‚Äî morning or evening?\n3. Any health issues or injuries?\n4. What's your goal ‚Äî just finish or do you have a desired time?",delay:2e3},{sender:"user",text:"I can train 3 times a week, preferably in the evening after work. Health is fine, no injuries.",delay:1600},{sender:"user",text:"I want to run 5K in 30 minutes or less ‚Äî is that realistic for a beginner?",delay:1400},{sender:"bot",text:"The goal of running 5K in 30 minutes (6:00/km pace) is absolutely achievable for a beginner in 2-3 months of preparation! It's a good motivating goal.",delay:2800},{sender:"bot",text:"**Weekly training plan:**\n\nüèÉ‚Äç‚ôÇÔ∏è **Monday** ‚Äî Easy run 20-25 min (heart rate 120-140)\nüèÉ‚Äç‚ôÇÔ∏è **Wednesday** ‚Äî Interval training: warm-up 10 min + 4x2 min fast/2 min rest + cool-down 10 min\nüèÉ‚Äç‚ôÇÔ∏è **Friday** ‚Äî Long run 30-40 min at comfortable pace",delay:3e3},{sender:"bot",text:"**First 2 weeks:** you can alternate running and brisk walking\n**Weeks 3-4:** increase continuous running\n**Weeks 5-8:** work on pace and endurance",delay:2500},{sender:"bot",text:"Shall we start this week? Ready for your first training session?",delay:1800}];let currentMessageIndex=0;let isPlaying=false;function createMessage(sender,text,animate=true){const messageDiv=document.createElement("div");messageDiv.className=`message ${sender}`;const avatarDiv=document.createElement("div");avatarDiv.className="message-avatar";if(sender==="bot"){const avatarImg=document.createElement("img");avatarImg.src="/generated-image.jpg";avatarImg.alt="Coach";avatarImg.style.width="100%";avatarImg.style.height="100%";avatarImg.style.borderRadius="50%";avatarImg.style.objectFit="cover";avatarDiv.appendChild(avatarImg)}else{avatarDiv.textContent="üë§"}const contentDiv=document.createElement("div");contentDiv.className="message-content";const formattedText=text.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");contentDiv.innerHTML=formattedText;const timeDiv=document.createElement("div");timeDiv.className="message-time";timeDiv.textContent=(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});contentDiv.appendChild(timeDiv);messageDiv.appendChild(avatarDiv);messageDiv.appendChild(contentDiv);if(animate){messageDiv.style.opacity="0";messageDiv.style.transform="translateY(30px) scale(0.95)"}return messageDiv}function createTypingIndicator(){const typingDiv=document.createElement("div");typingDiv.className="message bot typing";const avatarDiv=document.createElement("div");avatarDiv.className="message-avatar";const avatarImg=document.createElement("img");avatarImg.src="/generated-image.jpg";avatarImg.alt="Coach";avatarImg.style.width="100%";avatarImg.style.height="100%";avatarImg.style.borderRadius="50%";avatarImg.style.objectFit="cover";avatarDiv.appendChild(avatarImg);const typingIndicator=document.createElement("div");typingIndicator.className="typing-indicator";typingIndicator.innerHTML=`
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    `;typingDiv.appendChild(avatarDiv);typingDiv.appendChild(typingIndicator);return typingDiv}function showMessage(messageElement,delay=0){return new Promise(resolve=>{setTimeout(()=>{messageElement.style.opacity="1";messageElement.style.transform="translateY(0) scale(1)";messageElement.style.transition="all 0.8s cubic-bezier(0.23, 1, 0.32, 1)";const chatMessages=document.getElementById("chat-messages");const messages=Array.from(chatMessages.children);messages.forEach((msg,index)=>{if(index<messages.length-3){msg.style.transform=`translateY(-${(messages.length-index-3)*8}px) scale(${1-(messages.length-index-3)*.05})`;msg.style.opacity=`${Math.max(.3,1-(messages.length-index-3)*.2)}`;msg.style.zIndex=index}else{msg.style.transform="translateY(0) scale(1)";msg.style.opacity="1";msg.style.zIndex=10+index}});if(messages.length>8){const oldestMessage=messages[0];oldestMessage.style.animation="messageDisappear 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55)";oldestMessage.style.animationFillMode="forwards";setTimeout(()=>{if(oldestMessage.parentNode){oldestMessage.parentNode.removeChild(oldestMessage)}},600)}resolve()},delay)})}async function playNextMessage(){if(currentMessageIndex>=demoMessages.length){isPlaying=false;setTimeout(()=>{startDemo()},5e3);return}const chatMessages=document.getElementById("chat-messages");const message=demoMessages[currentMessageIndex];let typingIndicator=null;if(message.sender==="bot"){typingIndicator=createTypingIndicator();chatMessages.appendChild(typingIndicator);chatMessages.scrollTop=chatMessages.scrollHeight;await new Promise(resolve=>setTimeout(resolve,1500));chatMessages.removeChild(typingIndicator)}const messageElement=createMessage(message.sender,message.text);chatMessages.appendChild(messageElement);await showMessage(messageElement,100);currentMessageIndex++;setTimeout(()=>{if(isPlaying){playNextMessage()}},message.delay)}function startDemo(){const chatMessages=document.getElementById("chat-messages");isPlaying=true;currentMessageIndex=0;chatMessages.innerHTML="";setTimeout(()=>{playNextMessage()},1e3)}function restartDemo(){setTimeout(()=>{if(!isPlaying){startDemo()}},5e3)}function detectLanguageAndRedirect(){if(window.location.pathname==="/"||window.location.pathname.includes("index.html")){return}const savedLanguage=localStorage.getItem("preferredLanguage");if(savedLanguage==="ru"){window.location.href="/";return}if(savedLanguage){return}const browserLanguage=navigator.language||navigator.languages[0];if(browserLanguage.startsWith("ru")){localStorage.setItem("preferredLanguage","ru");window.location.href="/"}else{localStorage.setItem("preferredLanguage","en")}}function setupLanguageSwitchers(){const languageLinks=document.querySelectorAll(".language-switch a");languageLinks.forEach(link=>{link.addEventListener("click",function(e){e.preventDefault();const href=this.getAttribute("href");const language=href==="/en/"?"en":"ru";localStorage.setItem("preferredLanguage",language);window.location.href=href})})}document.addEventListener("DOMContentLoaded",function(){if(window.location.pathname==="/en/"||window.location.pathname.includes("index-en")){detectLanguageAndRedirect()}setupLanguageSwitchers();updateStats();updateTestimonials();setTimeout(()=>{startDemo()},2e3)});setInterval(updateStats,12e4);setInterval(updateTestimonials,1e4);